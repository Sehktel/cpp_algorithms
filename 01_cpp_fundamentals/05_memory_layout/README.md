# –¢–µ–º–∞ 5: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã C++ –≤ –ø–∞–º—è—Ç—å

## üìö –û–ø–∏—Å–∞–Ω–∏–µ

–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ - —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –æ–±–ª–∞—Å—Ç–∏ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –≠—Ç–æ –∑–Ω–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è:
- –ê–Ω–∞–ª–∏–∑–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (forensics)
- –ü–æ–Ω–∏–º–∞–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
- –†–∞–±–æ—Ç—ã —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏
- –†–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤ –∏ –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–∏—Ö

## üéØ –¶–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è

- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ –ø–∞–º—è—Ç–∏
- –†–∞–±–æ—Ç–∞ —Å –±–∏—Ç–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ (bit fields)
- –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (alignment) –∏ padding
- –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª–∏
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ (reinterpret_cast)

## üîó –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ–º–∞–º–∏

### –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç–µ–º—ã
- [–¢–µ–º–∞ 3: Shared libraries](../03_shared_libraries/) - –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ø–∞–º—è—Ç–∏
- –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä C++

### –°–ª–µ–¥—É—é—â–∏–µ —Ç–µ–º—ã
- [–¢–µ–º–∞ 7: File I/O](../07_file_io/) - –±–∏–Ω–∞—Ä–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä
- [–¢–µ–º–∞ 9: GDB –æ—Ç–ª–∞–¥–∫–∞](../../03_debugging_analysis/09_gdb_disasm/) - –∞–Ω–∞–ª–∏–∑ –ø–∞–º—è—Ç–∏ –≤ –æ—Ç–ª–∞–¥—á–∏–∫–µ
- [–¢–µ–º–∞ 12: strace/ltrace](../../03_debugging_analysis/12_strace_ltrace/) - –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é
- [–¢–µ–º–∞ 21: DFIR](../../07_forensics/21_dfir/) - –∞–Ω–∞–ª–∏–∑ –¥–∞–º–ø–æ–≤ –ø–∞–º—è—Ç–∏ (Volatility)
- [–¢–µ–º–∞ 22: CVE Analysis](../../08_advanced_topics/22_cve_analysis/) - –∞–Ω–∞–ª–∏–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø–∞–º—è—Ç—å—é

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã

```
05_memory_layout/
‚îú‚îÄ‚îÄ README.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ struct_memory.cpp           # –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –≤ –ø–∞–º—è—Ç–∏
‚îî‚îÄ‚îÄ examples/                    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
    ‚îú‚îÄ‚îÄ alignment_padding.cpp
    ‚îú‚îÄ‚îÄ binary_protocol.cpp
    ‚îî‚îÄ‚îÄ memory_visualization.cpp
```

## üöÄ –ó–∞–ø—É—Å–∫

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è

```bash
# Linux/macOS
g++ -std=c++11 -Wall -Wextra struct_memory.cpp -o struct_memory

# Windows (MinGW)
g++ -std=c++11 -Wall -Wextra struct_memory.cpp -o struct_memory.exe
```

### –ó–∞–ø—É—Å–∫

```bash
./struct_memory
```

## üìñ –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

### –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ –ø–∞–º—è—Ç–∏

**–ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π:**
- –ü–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å padding –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è

**–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ (Alignment):**
```cpp
struct Example {
    char a;      // 1 –±–∞–π—Ç, offset 0
    // padding 3 –±–∞–π—Ç–∞ (–¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è int)
    int b;       // 4 –±–∞–π—Ç–∞, offset 4
    char c;      // 1 –±–∞–π—Ç, offset 8
    // padding 3 –±–∞–π—Ç–∞
};  // –†–∞–∑–º–µ—Ä: 12 –±–∞–π—Ç (–Ω–µ 6!)
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞:**
```cpp
// –ü–ª–æ—Ö–æ: 12 –±–∞–π—Ç
struct Bad {
    char a;
    int b;
    char c;
};

// –•–æ—Ä–æ—à–æ: 6 –±–∞–π—Ç
struct Good {
    int b;
    char a;
    char c;
};
```

### –ë–∏—Ç–æ–≤—ã–µ –ø–æ–ª—è (Bit Fields)

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**
```cpp
struct CELL {
    unsigned short character  : 8;  // 8 –±–∏—Ç –¥–ª—è —Å–∏–º–≤–æ–ª–∞
    unsigned short foreground : 3;  // 3 –±–∏—Ç–∞ –¥–ª—è —Ü–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –ø–ª–∞–Ω–∞
    unsigned short intensity  : 1;  // 1 –±–∏—Ç –¥–ª—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
    unsigned short background : 3;  // 3 –±–∏—Ç–∞ –¥–ª—è —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞
    unsigned short blink      : 1;  // 1 –±–∏—Ç –¥–ª—è –º–∏–≥–∞–Ω–∏—è
};
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏
- –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º –±–∏—Ç–∞–º
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–∞–º

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ü–æ—Ä—è–¥–æ–∫ –±–∏—Ç–æ–≤ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç endianness
- –ù–µ–ª—å–∑—è –≤–∑—è—Ç—å –∞–¥—Ä–µ—Å –±–∏—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
- –†–∞–∑–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä–æ–º –±–∞–∑–æ–≤–æ–≥–æ —Ç–∏–ø–∞

### –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏

**reinterpret_cast:**
```cpp
// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–∞–π—Ç—ã
unsigned char* bytes = reinterpret_cast<unsigned char*>(&structure);

// –ü—Ä—è–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
bytes[0] |= 0xC0;  // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏—Ç—ã 6 –∏ 7
bytes[1] &= 0xBB;  // –°–±—Ä–æ—Å–∏—Ç—å –±–∏—Ç—ã 6 –∏ 3
```

**–û–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å endianness
- –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ç–∏–ø–∞—Ö

### Endianness

**Little-endian (x86, x86-64):**
```
–ß–∏—Å–ª–æ 0x12345678 –≤ –ø–∞–º—è—Ç–∏:
–ê–¥—Ä–µ—Å:  0x00  0x01  0x02  0x03
–ó–Ω–∞—á–µ–Ω–∏–µ: 78   56   34   12
```

**Big-endian (—Å–µ—Ç–µ–≤–æ–π –ø–æ—Ä—è–¥–æ–∫, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ ARM):**
```
–ß–∏—Å–ª–æ 0x12345678 –≤ –ø–∞–º—è—Ç–∏:
–ê–¥—Ä–µ—Å:  0x00  0x01  0x02  0x03
–ó–Ω–∞—á–µ–Ω–∏–µ: 12   34   56   78
```

## üõ† –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

### –ü—Ä–∏–º–µ—Ä: struct_memory.cpp

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- –°—Ç—Ä—É–∫—Ç—É—Ä—É —Å –±–∏—Ç–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ (CELL)
- –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª–∏
- –ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (OR, AND)
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
```cpp
// –î–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–∞–∫ –∫ –±–∞–π—Ç–∞–º
unsigned char* bytes = reinterpret_cast<unsigned char*>(&orange);

// –ë–∏—Ç–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è OR
bytes[0] |= 0xC0;  // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏—Ç—ã

// –ë–∏—Ç–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è AND
bytes[1] &= 0xBB;  // –°–±—Ä–æ—Å–∏—Ç—å –±–∏—Ç—ã
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

1. **–ê–Ω–∞–ª–∏–∑ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `offsetof()` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–º–µ—â–µ–Ω–∏–π –ø–æ–ª–µ–π
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞

2. **–ë–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª:**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
   - –£—á–µ—Å—Ç—å endianness –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å–µ—Ç–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏:**
   - –í—ã–≤–µ—Å—Ç–∏ hex –¥–∞–º–ø —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è

## üîç –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

1. –ü–æ—á–µ–º—É —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ —Å—É–º–º—ã —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ–ª–µ–π?
2. –ß—Ç–æ —Ç–∞–∫–æ–µ padding –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?
3. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É little-endian –∏ big-endian?
4. –ü–æ—á–µ–º—É –±–∏—Ç–æ–≤—ã–µ –ø–æ–ª—è –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏?
5. –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–∏ –ø—Ä—è–º–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª–∏?

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Data Structure Alignment](https://en.wikipedia.org/wiki/Data_structure_alignment)
- [Endianness](https://en.wikipedia.org/wiki/Endianness)
- [Bit Fields in C++](https://en.cppreference.com/w/cpp/language/bit_field)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** `cpp_base/struct.cpp` (legacy)  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025

