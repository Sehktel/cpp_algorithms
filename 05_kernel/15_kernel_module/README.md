# –¢–µ–º–∞ 15: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è —è–¥—Ä–∞ Linux

## üìö –û–ø–∏—Å–∞–Ω–∏–µ

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª–µ–π —è–¥—Ä–∞ Linux –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã. –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è:
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –°–æ–∑–¥–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç
- –ü–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —è–¥—Ä–∞
- –ê–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —è–¥—Ä–∞

## üéØ –¶–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è

- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–¥—É–ª—è —è–¥—Ä–∞
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ API —è–¥—Ä–∞ Linux
- –†–∞–±–æ—Ç–∞ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤—ã–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π
- –û—Ç–ª–∞–¥–∫–∞ –º–æ–¥—É–ª–µ–π —è–¥—Ä–∞

## üîó –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ–º–∞–º–∏

### –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç–µ–º—ã
- [–¢–µ–º–∞ 14: Minimal kernel](../14_minimal_kernel/) - –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —è–¥—Ä–∞
- [–¢–µ–º–∞ 4: Signals](../../01_cpp_fundamentals/04_signals/) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ –º–æ–¥—É–ª—è—Ö

### –°–ª–µ–¥—É—é—â–∏–µ —Ç–µ–º—ã
- [–¢–µ–º–∞ 20: SELinux/AppArmor](../../06_security_tools/20_selinux_apparmor/) - –º–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —è–¥—Ä–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã

```
15_kernel_module/
‚îú‚îÄ‚îÄ README.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ examples/                    # –ü—Ä–∏–º–µ—Ä—ã –º–æ–¥—É–ª–µ–π (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
```

## üöÄ –ó–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —è–¥—Ä–∞
sudo apt-get install linux-headers-$(uname -r)

# –ò–ª–∏ –¥–ª—è Fedora
sudo dnf install kernel-devel
```

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è –º–æ–¥—É–ª—è

```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–¥—É–ª—è
cd examples
make

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è
sudo insmod hello_module.ko

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
lsmod | grep hello_module
dmesg | tail

# –í—ã–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è
sudo rmmod hello_module
```

### Makefile –¥–ª—è –º–æ–¥—É–ª—è

```makefile
obj-m += hello_module.o

KDIR := /lib/modules/$(shell uname -r)/build
PWD := $(shell pwd)

all:
	$(MAKE) -C $(KDIR) M=$(PWD) modules

clean:
	$(MAKE) -C $(KDIR) M=$(PWD) clean
```

## üìñ –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–æ–¥—É–ª—å —è–¥—Ä–∞?

–ú–æ–¥—É–ª—å —è–¥—Ä–∞ (kernel module) - —ç—Ç–æ –æ–±—ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —è–¥—Ä–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã. –ú–æ–¥—É–ª–∏ —Ä–∞—Å—à–∏—Ä—è—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —è–¥—Ä–∞.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `module_init()` - —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `module_exit()` - —Ñ—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:**
- `MODULE_LICENSE()` - –ª–∏—Ü–µ–Ω–∑–∏—è
- `MODULE_AUTHOR()` - –∞–≤—Ç–æ—Ä
- `MODULE_DESCRIPTION()` - –æ–ø–∏—Å–∞–Ω–∏–µ

### API —è–¥—Ä–∞

**–†–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é:**
- `kmalloc()` / `kfree()` - –≤—ã–¥–µ–ª–µ–Ω–∏–µ/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- `vmalloc()` / `vfree()` - –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å

**–†–∞–±–æ—Ç–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏:**
- `register_chrdev()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `unregister_chrdev()` - –æ—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π:**
- `file_operations` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏
- `proc` / `sysfs` - –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–æ–¥—É–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —è–¥—Ä–∞
- –û—à–∏–±–∫–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫—Ä–∞—Ö—É —Å–∏—Å—Ç–µ–º—ã
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –ø–∞–º—è—Ç–∏ (–∫–∞–∫ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ)

**–ü—Ä–∞–∫—Ç–∏–∫–∏:**
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏

## üõ† –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –º–æ–¥—É–ª—å

–°–º. [examples/hello_module.c](./examples/hello_module.c) - –ø—Ä–æ—Å—Ç–æ–π –º–æ–¥—É–ª—å, –≤—ã–≤–æ–¥—è—â–∏–π —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.

### –ü—Ä–∏–º–µ—Ä 2: –ú–æ–¥—É–ª—å —Å /proc –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

–°–º. [examples/proc_module.c](./examples/proc_module.c) - –º–æ–¥—É–ª—å, —Å–æ–∑–¥–∞—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ /proc.

### –ü—Ä–∏–º–µ—Ä 3: –ú–æ–¥—É–ª—å —Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–°–º. [examples/char_device.c](./examples/char_device.c) - –º–æ–¥—É–ª—å, —Å–æ–∑–¥–∞—é—â–∏–π —Å–∏–º–≤–æ–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–¥—É–ª—è:**
   - –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —Å init/exit —Ñ—É–Ω–∫—Ü–∏—è–º–∏
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –≤—ã–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–≤–æ–¥ –≤ dmesg

2. **–ú–æ–¥—É–ª—å —Å /proc –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º:**
   - –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ /proc
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É

3. **–ú–æ–¥—É–ª—å —Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
   - –°–æ–∑–¥–∞—Ç—å —Å–∏–º–≤–æ–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ read/write
   - –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º

## üîç –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

1. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –º–æ–¥—É–ª–µ–º —è–¥—Ä–∞ –∏ –æ–±—ã—á–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π?
2. –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –º–æ–¥—É–ª—è —è–¥—Ä–∞?
3. –ö–∞–∫ –º–æ–¥—É–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å —è–¥—Ä–æ–º?
4. –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –≤ –º–æ–¥—É–ª—è—Ö?
5. –ö–∞–∫ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –º–æ–¥—É–ª–∏ —è–¥—Ä–∞?
6. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É kmalloc –∏ vmalloc?
7. –ö–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã?

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Linux Kernel Module Programming Guide](https://www.tldp.org/LDP/lkmpg/2.6/html/)
- [The Linux Kernel](https://www.kernel.org/)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–∞–∑–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–æ–∑–¥–∞–Ω—ã  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025

